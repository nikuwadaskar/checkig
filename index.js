TemporaryCart = {
    "token": "c1-fa8bf13b4bf07427b62b25e7faf02f54",
    "note": "",
    "attributes": {},
    "original_total_price": 14400,
    "total_price": 14400,
    "total_discount": 0,
    "total_weight": 0,
    "item_count": 4,
    "items": [
        {
            "id": 45965700071697,
            "properties": {
                "_clientDesignId": "78938d10ec23456da0a5eecdff45a214",
                "_projectId": "xw6l29v03C",
                "design": "https://designer.antigro.com/en?clientDesignId=78938d10ec23456da0a5eecdff45a214"
            },
            "quantity": 1,
            "variant_id": 45965700071697,
            "key": "45965700071697:4013dd87-e064-4b04-8d74-1e5cd4622838",
            "title": "UV DTF TRANSFERS (STICKERS) - BUILD YOUR GANG SHEETS - 22x24",
            "price": 3600,
            "original_price": 3600,
            "discounted_price": 3600,
            "line_price": 3600,
            "original_line_price": 3600,
            "total_discount": 0,
            "discounts": [],
            "sku": null,
            "grams": 0,
            "vendor": "EzPrintHouz",
            "taxable": true,
            "product_id": 8593014718737,
            "product_has_only_default_variant": false,
            "gift_card": false,
            "final_price": 3600,
            "final_line_price": 3600,
            "url": "/products/uv-dtf-transfers-stickers-build-your-gang-sheets?variant=45965700071697",
            "featured_image": {
                "aspect_ratio": 1,
                "alt": "UV DTF TRANSFERS (STICKERS) - BUILD YOUR GANG SHEETS",
                "height": 800,
                "url": "https://cdn.shopify.com/s/files/1/0688/6195/2273/files/359384791_279303361310787_2768581040788819637_n_05d49095-ff84-4b6f-b6d3-04ff9c0fc8bc.jpg?v=1689129139",
                "width": 800
            },
            "image": "https://cdn.shopify.com/s/files/1/0688/6195/2273/files/359384791_279303361310787_2768581040788819637_n_05d49095-ff84-4b6f-b6d3-04ff9c0fc8bc.jpg?v=1689129139",
            "handle": "uv-dtf-transfers-stickers-build-your-gang-sheets",
            "requires_shipping": true,
            "product_type": "",
            "product_title": "UV DTF TRANSFERS (STICKERS) - BUILD YOUR GANG SHEETS",
            "product_description": "Introducing Custom UV DTF Transfers: Elevate Your Hard Surfaces!\nTransform wood, laptops, drinkware, and more with our Custom UV DTF Transfers. Waterproof, scratch-resistant, and fade-proof, these transfers are perfect for non-clothing items. Dishwasher safe and long-lasting, they bring your designs to life.\nDesign Guidelines:\n\nUpload files in 300DPI, sized at 22 inches by your chosen height.\nUse PNG or PDF format.\nRemove backgrounds, avoid mirroring, and check edges for a seamless look.\nSmall text under 8px and intricate details are not recommended.\n\nYour Vision, Our Commitment: You're responsible for the final design output. Reprints require full payment unless design and editing services were requested.\nUnlock the potential of your hard surfaces with Custom UV DTF Transfers. Stand out, make a statement, and leave a lasting impression. Contact us today to bring your vision to life!",
            "variant_title": "22x24",
            "variant_options": [
                "22x24"
            ],
            "options_with_values": [
                {
                    "name": "Size",
                    "value": "22x24"
                }
            ],
            "line_level_discount_allocations": [],
            "line_level_total_discount": 0,
            "has_components": false
        },
        {
            "id": 45965700071697,
            "properties": {
                "_clientDesignId": "27ffa4d77cee42338a159344b91acd06",
                "_projectId": "OpzFPMHl3Q",
                "design": "https://designer.antigro.com/en?clientDesignId=27ffa4d77cee42338a159344b91acd06"
            },
            "quantity": 1,
            "variant_id": 45965700071697,
            "key": "45965700071697:07f88402-34a9-45a0-9e97-3f264bffb3e0",
            "title": "UV DTF TRANSFERS (STICKERS) - BUILD YOUR GANG SHEETS - 22x24",
            "price": 3600,
            "original_price": 3600,
            "discounted_price": 3600,
            "line_price": 3600,
            "original_line_price": 3600,
            "total_discount": 0,
            "discounts": [],
            "sku": null,
            "grams": 0,
            "vendor": "EzPrintHouz",
            "taxable": true,
            "product_id": 8593014718737,
            "product_has_only_default_variant": false,
            "gift_card": false,
            "final_price": 3600,
            "final_line_price": 3600,
            "url": "/products/uv-dtf-transfers-stickers-build-your-gang-sheets?variant=45965700071697",
            "featured_image": {
                "aspect_ratio": 1,
                "alt": "UV DTF TRANSFERS (STICKERS) - BUILD YOUR GANG SHEETS",
                "height": 800,
                "url": "https://cdn.shopify.com/s/files/1/0688/6195/2273/files/359384791_279303361310787_2768581040788819637_n_05d49095-ff84-4b6f-b6d3-04ff9c0fc8bc.jpg?v=1689129139",
                "width": 800
            },
            "image": "https://cdn.shopify.com/s/files/1/0688/6195/2273/files/359384791_279303361310787_2768581040788819637_n_05d49095-ff84-4b6f-b6d3-04ff9c0fc8bc.jpg?v=1689129139",
            "handle": "uv-dtf-transfers-stickers-build-your-gang-sheets",
            "requires_shipping": true,
            "product_type": "",
            "product_title": "UV DTF TRANSFERS (STICKERS) - BUILD YOUR GANG SHEETS",
            "product_description": "Introducing Custom UV DTF Transfers: Elevate Your Hard Surfaces!\nTransform wood, laptops, drinkware, and more with our Custom UV DTF Transfers. Waterproof, scratch-resistant, and fade-proof, these transfers are perfect for non-clothing items. Dishwasher safe and long-lasting, they bring your designs to life.\nDesign Guidelines:\n\nUpload files in 300DPI, sized at 22 inches by your chosen height.\nUse PNG or PDF format.\nRemove backgrounds, avoid mirroring, and check edges for a seamless look.\nSmall text under 8px and intricate details are not recommended.\n\nYour Vision, Our Commitment: You're responsible for the final design output. Reprints require full payment unless design and editing services were requested.\nUnlock the potential of your hard surfaces with Custom UV DTF Transfers. Stand out, make a statement, and leave a lasting impression. Contact us today to bring your vision to life!",
            "variant_title": "22x24",
            "variant_options": [
                "22x24"
            ],
            "options_with_values": [
                {
                    "name": "Size",
                    "value": "22x24"
                }
            ],
            "line_level_discount_allocations": [],
            "line_level_total_discount": 0,
            "has_components": false
        },
        {
            "id": 45965700071697,
            "properties": {
                "_clientDesignId": "41b74196b1a142d4bf96399c4a764ac0",
                "_projectId": "VG8azcBSZR",
                "design": "https://designer.antigro.com/en?clientDesignId=41b74196b1a142d4bf96399c4a764ac0"
            },
            "quantity": 2,
            "variant_id": 45965700071697,
            "key": "45965700071697:a1c29ad3-c605-4c8b-be27-6f7c0516cc0d",
            "title": "UV DTF TRANSFERS (STICKERS) - BUILD YOUR GANG SHEETS - 22x24",
            "price": 3600,
            "original_price": 3600,
            "discounted_price": 3600,
            "line_price": 7200,
            "original_line_price": 7200,
            "total_discount": 0,
            "discounts": [],
            "sku": null,
            "grams": 0,
            "vendor": "EzPrintHouz",
            "taxable": true,
            "product_id": 8593014718737,
            "product_has_only_default_variant": false,
            "gift_card": false,
            "final_price": 3600,
            "final_line_price": 7200,
            "url": "/products/uv-dtf-transfers-stickers-build-your-gang-sheets?variant=45965700071697",
            "featured_image": {
                "aspect_ratio": 1,
                "alt": "UV DTF TRANSFERS (STICKERS) - BUILD YOUR GANG SHEETS",
                "height": 800,
                "url": "https://cdn.shopify.com/s/files/1/0688/6195/2273/files/359384791_279303361310787_2768581040788819637_n_05d49095-ff84-4b6f-b6d3-04ff9c0fc8bc.jpg?v=1689129139",
                "width": 800
            },
            "image": "https://cdn.shopify.com/s/files/1/0688/6195/2273/files/359384791_279303361310787_2768581040788819637_n_05d49095-ff84-4b6f-b6d3-04ff9c0fc8bc.jpg?v=1689129139",
            "handle": "uv-dtf-transfers-stickers-build-your-gang-sheets",
            "requires_shipping": true,
            "product_type": "",
            "product_title": "UV DTF TRANSFERS (STICKERS) - BUILD YOUR GANG SHEETS",
            "product_description": "Introducing Custom UV DTF Transfers: Elevate Your Hard Surfaces!\nTransform wood, laptops, drinkware, and more with our Custom UV DTF Transfers. Waterproof, scratch-resistant, and fade-proof, these transfers are perfect for non-clothing items. Dishwasher safe and long-lasting, they bring your designs to life.\nDesign Guidelines:\n\nUpload files in 300DPI, sized at 22 inches by your chosen height.\nUse PNG or PDF format.\nRemove backgrounds, avoid mirroring, and check edges for a seamless look.\nSmall text under 8px and intricate details are not recommended.\n\nYour Vision, Our Commitment: You're responsible for the final design output. Reprints require full payment unless design and editing services were requested.\nUnlock the potential of your hard surfaces with Custom UV DTF Transfers. Stand out, make a statement, and leave a lasting impression. Contact us today to bring your vision to life!",
            "variant_title": "22x24",
            "variant_options": [
                "22x24"
            ],
            "options_with_values": [
                {
                    "name": "Size",
                    "value": "22x24"
                }
            ],
            "line_level_discount_allocations": [],
            "line_level_total_discount": 0,
            "has_components": false
        }
    ],
    "requires_shipping": true,
    "currency": "USD",
    "items_subtotal_price": 14400,
    "cart_level_discount_applications": []
}


const myBackend = "http://127.0.0.1:5500/index.html"

//? cart update hone ke baad edit button ka url bhi update hone chahiye 
async function initializeScript() {
    let myData = {}
    myData.urlParams = transformPropertiesToUrl()
    myData?.urlParams?.comeFromUrl = false
    myData.currentCart = await loadCart();
    manageCartAdd()
    function transformPropertiesToUrl() {
        // ... (transforms properties to URLs in the DOM)
        const urlString = 'https://ezprinthouz.com/cart?clientDesignId=78938d10ec23456da0a5eecdff45a214&projectIds=xw6l29v03C&projectVolumes=1&projectVariantIds=45965700071697';
        const url = new URL(urlString);
        const params = new URLSearchParams(url.search);
        const clientDesignId = params.get('clientDesignId');
        const projectIds = params.get('projectIds');
        const projectVolumes = params.get('projectVolumes');
        const projectVariantIds = params.get('projectVariantIds');
        const shopifyCartUrl = window.location.origin
        if (clientDesignId.length < 1) {
            return false
        }
        return {
            comeFromUrl: true,
            clientDesignId,
            projectIds,
            projectVolumes,
            projectVariantIds,
            shopifyCartUrl
        }
    }
    function loadCart() {
        // ... (fetches and returns cart data)
        return TemporaryCart
        return fetch('/cart.js', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json;'
            },
        })
            .then(function (response) {
                return response.json();
            })
            .then(function (cart) {
                return cart;
            })
            .catch(function (err) {
                throw err;
            })
    }

    async function addVariantsRequest(productToAdd) {
        // ... (adds Varlets to the cart and returns the result)
        return fetch('/cart/add.js', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json;'
            },
            body: JSON.stringify({ items: productToAdd })
        })
            .then(function (response) {
                return response.json();
            })

    }

    function generateThumbUrl() {
        if (myData.urlParams.comeFromUrl.clientDesignId) {
            return `${myBackend}?clientDesignId=${myData.urlParams.comeFromUrl.clientDesignId}`
        }
        return null
    }

    function addProperties() {
        if (myData.urlParams.comeFromUrl == false) {
            return false
        }

        thumbUrl = generateThumbUrl()
        // ... (adds properties to the cart and returns the result)
        return {
            id: myData.urlParams.comeFromUrl.projectVariantIds,
            quantity: myData.urlParams.comeFromUrl.projectVolumes,
            properties: {
                clientDesignId: myData.urlParams.comeFromUrl.clientDesignId,
                projectId: myData.urlParams.comeFromUrl.projectIds,
                thumbUrl: thumbUrl,
            }
        }

    }

    async function manageCartAdd() {
        const productToAdd = addProperties()
        if (typeof (productToAdd) == "boolean" && productToAdd == false) {
            return
        }
        const result = await addVariantsRequest(productToAdd)
        // reload cart to remove get params
        window.location.href = myData?.urlParams?.shopifyCartUrl;
    }


    /// Manage cart section 
    (function () {
        // Store the original fetch function
        const originalFetch = window.fetch;
        // Override the fetch function to log the URL after the request is completed
        window.fetch = function (url, options) {
            // Call the original fetch function
            return originalFetch(url, options)
                .then(response => {
                    console.log('Fetch request completed successfully. URL:', url);
                    // You can add your own custom logic here for successful requests
                    if (url.includes("change")) {
                        manageChangeButton()
                    }
                    return response;
                })
                .catch(error => {
                    console.error('Error in fetch request. URL:', url, 'Error:', error);

                });
        };
    })();
    manageEditButton()
    function manageEditButton() {
        //myData.currentCart.items.map(()=>{
        TemporaryCart.items.map((item) => {
            const currentVolume = editButton(item)
            const url = createURL(item.quantity, item.properties)
            if (status)
                document.getElementById("edit-button-link").addEventListener("click", getToOurEnd(elem))
        })
    }

    // function editButton() {
    //     document.querySelectorAll("cart-items").forEach((elem) => {

    //     })
    // }

    function createURL(quantity, prop) {
        const queryParamsObject = {
            clientDesignId: prop?.clientDesignId,
            projectIds: prop?.projectId,
            projectVolumes: quantity
        }
        function objectToQueryString(obj) {
            const params = new URLSearchParams();
            for (const key in obj) {
                if (obj.hasOwnProperty(key)) {
                    params.append(key, obj[key]);
                }
            }
            return params.toString();
        }

        // Create the URL with query parameters
        const queryString = objectToQueryString(queryParamsObject);
        const finalUrl = `${myBackend}?${queryString}`;
        return finalUrl;
    }

    function getToOurEnd(elem) {
        console.log(elem)
    }


}

document?.addEventListener('DOMContentLoaded', function () {
    editButton()
    console.log("page loaded")
})
initializeScript();


function editButton(item) {
    console.log(document.querySelectorAll(".cart-item"))

    document.querySelectorAll(".cart-item").forEach((elem) => {
        console.log("elem", elem)
        const cartVolumeElem = elem.querySelector(".cart-item__details")
        const elemAnchor = createElemStructure(item)
        cartVolumeElem.appendChild(elemAnchor)
    })
}

function createElemStructure(item) {
    function createCartItem(clientDesignId, projectIds, projectVolumes) {
        const container = document.createElement('div');
        container.classList.add('cart__item--properties');

        const designLabel = document.createElement('span');
        designLabel.textContent = 'design:';
        designLabel.setAttribute('data-is-antigro-designer-link', 'y');

        const editLink = document.createElement('a');
        editLink.href = `${myBackend}?clientDesignId=${clientDesignId}&projectIds=${projectIds}&projectVolumes=${projectVolumes}`;
        editLink.classList.add('button', 'button--primary');
        editLink.textContent = 'Edit';

        container.appendChild(designLabel);
        container.appendChild(editLink);

        return container;
    }

    const clientDesignId = item.properties.clientDesignId;
    const projectIds = item.properties.projectId;
    const projectVolumes = item.quantity;

    const cartItem = createCartItem(clientDesignId, projectIds, projectVolumes);
    return cartItem

}